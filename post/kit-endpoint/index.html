<!DOCTYPE html>
<html lang="cn-ZH">
<head>

  <meta charset="utf-8" />

  
  <title>Kit ä»transportåˆ°service</title>

  
  





  
  <meta name="author" content="Jerry" />
  <meta name="description" content="kit å·¥å…·åº“ä¸­ï¼Œå¦‚æœè¦æ„å»ºä¸€ä¸ªæœåŠ¡ï¼Œåˆ™éœ€è¦å‡†å¤‡transportï¼Œendpointï¼Œserviceæœ¬æ–‡å°±æ¥è¯´ä¸€è¯´ä¸‰å±‚å…·ä½“æ˜¯æ€ä¹ˆä¸²èµ·æ¥çš„ å¹¶çœ‹çœ‹ä¸­é—´ä»¶æ˜¯æ€ä¹ˆæ’è¿›æ¥çš„ã€‚
" />

  
  
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@gohugoio" />
    <meta name="twitter:title" content="Kit ä»transportåˆ°service" />
    <meta name="twitter:description" content="kit å·¥å…·åº“ä¸­ï¼Œå¦‚æœè¦æ„å»ºä¸€ä¸ªæœåŠ¡ï¼Œåˆ™éœ€è¦å‡†å¤‡transportï¼Œendpointï¼Œserviceæœ¬æ–‡å°±æ¥è¯´ä¸€è¯´ä¸‰å±‚å…·ä½“æ˜¯æ€ä¹ˆä¸²èµ·æ¥çš„ å¹¶çœ‹çœ‹ä¸­é—´ä»¶æ˜¯æ€ä¹ˆæ’è¿›æ¥çš„ã€‚
" />
    <meta name="twitter:image" content="https://mfslog.github.io/media/post-cover/10981023.png" />
  

  
  <meta property="og:type" content="article" />
  <meta property="og:title" content="Kit ä»transportåˆ°service" />
  <meta property="og:description" content="kit å·¥å…·åº“ä¸­ï¼Œå¦‚æœè¦æ„å»ºä¸€ä¸ªæœåŠ¡ï¼Œåˆ™éœ€è¦å‡†å¤‡transportï¼Œendpointï¼Œserviceæœ¬æ–‡å°±æ¥è¯´ä¸€è¯´ä¸‰å±‚å…·ä½“æ˜¯æ€ä¹ˆä¸²èµ·æ¥çš„ å¹¶çœ‹çœ‹ä¸­é—´ä»¶æ˜¯æ€ä¹ˆæ’è¿›æ¥çš„ã€‚
" />
  <meta property="og:url" content="https://mfslog.github.io/post/kit-endpoint/" />
  <meta property="og:image" content="https://mfslog.github.io/media/post-cover/10981023.png" />




<meta name="generator" content="Hugo 0.51" />


<link rel="canonical" href="https://mfslog.github.io/post/kit-endpoint/" />
<link rel="alternative" href="https://mfslog.github.io/index.xml" title="Jerry&#39;s Blog" type="application/atom+xml" />


<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="format-detection" content="telephone=no,email=no,adress=no" />
<meta http-equiv="Cache-Control" content="no-transform" />


<meta name="robots" content="index,follow" />
<meta name="referrer" content="origin-when-cross-origin" />
<meta name="google-site-verification" content="_moDmnnBNVLBN1rzNxyGUGdPHE20YgbmrtzLIbxaWFc" />
<meta name="msvalidate.01" content="22596E34341DD1D17D6022C44647E587" />





<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="Jerry&#39;s Blog" />
<meta name="msapplication-tooltip" content="Jerry&#39;s Blog" />
<meta name='msapplication-navbutton-color' content="#5fbf5e" />
<meta name="msapplication-TileColor" content="#5fbf5e" />
<meta name="msapplication-TileImage" content="/img/tile-image-windows.png" />
<link rel="icon" href="https://mfslog.github.io/img/favicon.ico" />
<link rel="icon" type="image/png" sizes="16x16" href="https://mfslog.github.io/img/favicon-16x16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="https://mfslog.github.io/img/favicon-32x32.png" />
<link rel="icon" sizes="192x192" href="https://mfslog.github.io/img/touch-icon-android.png" />
<link rel="apple-touch-icon" href="https://mfslog.github.io/img/touch-icon-apple.png" />
<link rel="mask-icon" href="https://mfslog.github.io/img/safari-pinned-tab.svg" color="#5fbf5e" />



<link rel="stylesheet" href="//cdn.bootcss.com/video.js/6.2.8/alt/video-js-cdn.min.css" />

<link rel="stylesheet" href="https://mfslog.github.io/css/bundle.ff02473a9a.css" />


  
  <!--[if lt IE 9]>
    <script src="//cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <script src="//cdn.bootcss.com/video.js/6.2.8/ie8/videojs-ie8.min.js"></script>
  <![endif]-->

<!--[if lte IE 11]>
    <script src="//cdn.bootcss.com/classlist/1.1.20170427/classList.min.js"></script>
  <![endif]-->


<script src="//cdn.bootcss.com/object-fit-images/3.2.3/ofi.min.js"></script>


<script src="//cdn.bootcss.com/smooth-scroll/12.1.4/js/smooth-scroll.polyfills.min.js"></script>


</head>
  <body>
    
    <div class="suspension">
      <a title="Go to top" class="to-top is-hide"><span class="icon icon-up"></span></a>
      
        
      
    </div>
    
    
  <header class="site-header">
  <img class="avatar" src="https://mfslog.github.io/img/avatar.jpg" alt="Avatar">
  
  <h2 class="title">Jerry&#39;s Blog</h2>
  
  <p class="subtitle">~ çˆ±çš„æˆ˜å£« ~</p>
  <button class="menu-toggle" type="button">
    <span class="icon icon-menu"></span>
  </button>
  <nav class="site-menu collapsed">
    <h2 class="offscreen">Main Menu</h2>
    <ul class="menu-list">
      
      
      
      
        <li class="menu-item
            
            
            
              is-active
            ">
            <a href="https://mfslog.github.io/">é¦–é¡µ</a>
          </li>
      
        <li class="menu-item
            
            
            ">
            <a href="https://mfslog.github.io/tags/">æ ‡ç­¾</a>
          </li>
      
        <li class="menu-item
            
            
            ">
            <a href="https://mfslog.github.io/links/">å‹é“¾</a>
          </li>
      
        <li class="menu-item
            
            
            ">
            <a href="https://mfslog.github.io/about/">å…³äº</a>
          </li>
      
    </ul>
  </nav>
  <nav class="social-menu collapsed">
    <h2 class="offscreen">Social Networks</h2>
    <ul class="social-list">

      
      <li class="social-item">
        <a href="mailto:Jerry.Chau@qq.com" title="Email"><span class="icon icon-email"></span></a>
      </li>

      
      <li class="social-item">
        <a href="//github.com/mfslog" title="GitHub"><span class="icon icon-github"></span></a>
      </li>

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <li class="social-item">
        <a href="https://mfslog.github.io/index.xml"><span class="icon icon-rss" title="RSS"></span></a>
      </li>

    </ul>
  </nav>
</header>

  <section class="main post-detail">
    <header class="post-header">
      <h1 class="post-title">Kit ä»transportåˆ°service</h1>
      <p class="post-meta">@Jerry Â· Jul 3, 2018 Â· 3 min read</p>
    </header>
    <article class="post-content"><p>kit å·¥å…·åº“ä¸­ï¼Œå¦‚æœè¦æ„å»ºä¸€ä¸ªæœåŠ¡ï¼Œåˆ™éœ€è¦å‡†å¤‡transportï¼Œendpointï¼Œserviceæœ¬æ–‡å°±æ¥è¯´ä¸€è¯´ä¸‰å±‚å…·ä½“æ˜¯æ€ä¹ˆä¸²èµ·æ¥çš„
å¹¶çœ‹çœ‹ä¸­é—´ä»¶æ˜¯æ€ä¹ˆæ’è¿›æ¥çš„ã€‚</p>

<h2 id="å„å±‚å®šä¹‰">å„å±‚å®šä¹‰</h2>

<h4 id="endpoint-æ¥å…¥ç‚¹">endpoint æ¥å…¥ç‚¹</h4>

<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Endpoint</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">request</span> <span style="color:#66d9ef">interface</span>{}) (<span style="color:#a6e22e">response</span> <span style="color:#66d9ef">interface</span>{}, <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>)</code></pre></div>
<p>ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œendpoint æ˜¯ä¸€ä¸ªå…¥å‚ä¸ºcontextå’Œç©ºæ¥å£ï¼Œå‡ºå‚ä¸ºç©ºæ¥å£å’Œé”™è¯¯ çš„å‡½æ•°ç­¾åã€‚</p>

<h4 id="middleware-ä¸­é—´ä»¶">middleware ä¸­é—´ä»¶</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">//endpointå±‚çš„ä¸­é—´ä»¶å®šä¹‰
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Middleware</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">Endpoint</span>) <span style="color:#a6e22e">Endpoint</span>
<span style="color:#75715e">//æœåŠ¡å±‚çš„ä¸­é—´ä»¶å®šä¹‰
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Middleware</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">Service</span>) <span style="color:#a6e22e">Service</span></code></pre></div>
<p>ä¸­é—´ä»¶ä¸åŒå±‚æœ‰ä¸åŒçš„å®šä¹‰çš„,ä½†æ˜¯è§„åˆ™æ˜¯å…¥å‚æ˜¯è¯¥å±‚å¯¹è±¡ï¼Œå‡ºå‚ä¹Ÿæ˜¯è¯¥å±‚å¯¹è±¡ã€‚</p>

<h4 id="service-æœåŠ¡æ¥å£">service æœåŠ¡æ¥å£</h4>

<p>æœåŠ¡å®šä¹‰æ˜¯é€šè¿‡protoæ–‡ä»¶ä¸­å®šä¹‰åç”Ÿæˆå¯¹åº”çš„pb.go æ–‡ä»¶ã€‚ç”¨kit çš„addsvcä½œä¸ºç¤ºä¾‹
protoæœåŠ¡æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-proto" data-lang="proto"><span style="color:#66d9ef">service</span> Add {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#75715e">// Sums two integers.
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">rpc</span> Sum (SumRequest) <span style="color:#66d9ef">returns</span> (SumReply) {}<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#75715e">// Concatenates two strings
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">rpc</span> Concat (ConcatRequest) <span style="color:#66d9ef">returns</span> (ConcatReply) {}<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}</code></pre></div>
<p>é€šè¿‡å‘½ä»¤ï¼šprotoc &ndash;go_out=plugins=grpc:. addsvc.proto å‘½ä»¤ç”Ÿæˆå¯¹åº”çš„pb.goæ–‡ä»¶
æˆ‘ä»¬åªè¦éœ€è¦å®ç°å¯¹åº”çš„æœåŠ¡æ¥å£ï¼Œå°±ç­‰äºå®ç°äº†å¯¹åº”çš„æœåŠ¡</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">AddServer</span> <span style="color:#66d9ef">interface</span> {
	<span style="color:#75715e">// Sums two integers.
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">Sum</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">SumRequest</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">SumReply</span>, <span style="color:#66d9ef">error</span>)
	<span style="color:#75715e">// Concatenates two strings
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">Concat</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">ConcatRequest</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">ConcatReply</span>, <span style="color:#66d9ef">error</span>)
}</code></pre></div>
<p>åœ¨transportå±‚å®šä¹‰ç»„åˆtransportç»“æ„ä½“ï¼Œå¹¶éœ€è¦å®ç°å¯¹åº”åŠŸèƒ½çš„æ¥å£</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">grpcServer</span>) <span style="color:#a6e22e">Sum</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">oldcontext</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">req</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">pb</span>.<span style="color:#a6e22e">SumRequest</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">pb</span>.<span style="color:#a6e22e">SumReply</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">rep</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">sum</span>.<span style="color:#a6e22e">ServeGRPC</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">req</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">rep</span>.(<span style="color:#f92672">*</span><span style="color:#a6e22e">pb</span>.<span style="color:#a6e22e">SumReply</span>), <span style="color:#66d9ef">nil</span>
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">grpcServer</span>) <span style="color:#a6e22e">Concat</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">oldcontext</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">req</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">pb</span>.<span style="color:#a6e22e">ConcatRequest</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">pb</span>.<span style="color:#a6e22e">ConcatReply</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">rep</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">concat</span>.<span style="color:#a6e22e">ServeGRPC</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">req</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">rep</span>.(<span style="color:#f92672">*</span><span style="color:#a6e22e">pb</span>.<span style="color:#a6e22e">ConcatReply</span>), <span style="color:#66d9ef">nil</span>
}</code></pre></div>
<h4 id="transport-ä¼ è¾“å±‚">transport ä¼ è¾“å±‚</h4>

<p>åœ¨å‘GRPC æ³¨å†ŒæœåŠ¡çš„æ—¶å€™,GRPC ä¼šæ£€æŸ¥æ³¨å†Œå¯¹è±¡æ˜¯å¦å®ç°äº†æœåŠ¡å®šä¹‰çš„æ¥å£ï¼Œå¦‚æœå®ç°äº†ï¼Œåˆ™ä¼šæ³¨å†Œå¯¹åº”çš„æ–¹æ³•åˆ°GRPCä¸­ã€‚
å½“ç½‘ç»œè¯·æ±‚å¯¹åº”çš„æœåŠ¡åç§°å’Œæ–¹æ³•çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨å¯¹åº”çš„æ–¹æ³•ã€‚kitä¸­ï¼Œå½“grpcè°ƒç”¨å¯¹åº”æ–¹æ³•çš„æ—¶å€™ï¼Œkitä¼šå»è°ƒç”¨å¯¹åº”çš„
å¤„ç†handlerï¼Œè°ƒç”¨è¿‡ç¨‹å¦‚ä¸Šé¢çš„ä»£ç ã€‚handlerçš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Handler</span> <span style="color:#66d9ef">interface</span> {
	<span style="color:#a6e22e">ServeGRPC</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">oldcontext</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">request</span> <span style="color:#66d9ef">interface</span>{}) (<span style="color:#a6e22e">oldcontext</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#66d9ef">interface</span>{}, <span style="color:#66d9ef">error</span>)
}</code></pre></div>
<p>è¿™ä¸ªæ¥å£ä¸­æ–¹æ³•çš„ç­¾åå’Œä¸Šé¢endpointå‡½æ•°æ–¹æ³•çš„ç­¾åæ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºtransportæœ€ç»ˆè¦è°ƒç”¨endpointï¼Œæ‰€ä»¥ä»–ä»¬éœ€è¦æ¥æ”¶åŒæ ·çš„å‚æ•°ã€‚
kitä¸­grpcçš„æœåŠ¡å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Server wraps an endpoint and implements grpc.Handler.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Server</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">e</span>         <span style="color:#a6e22e">endpoint</span>.<span style="color:#a6e22e">Endpoint</span>
	<span style="color:#a6e22e">dec</span>       <span style="color:#a6e22e">DecodeRequestFunc</span>
	<span style="color:#a6e22e">enc</span>       <span style="color:#a6e22e">EncodeResponseFunc</span>
	<span style="color:#a6e22e">before</span>    []<span style="color:#a6e22e">ServerRequestFunc</span>
	<span style="color:#a6e22e">after</span>     []<span style="color:#a6e22e">ServerResponseFunc</span>
	<span style="color:#a6e22e">finalizer</span> []<span style="color:#a6e22e">ServerFinalizerFunc</span>
	<span style="color:#a6e22e">logger</span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Logger</span>
}</code></pre></div>
<p>é€šè¿‡ä¸Šé¢ä»£ç ä¸­çš„æ³¨é‡Šï¼Œå¯ä»¥çŸ¥é“Serverç»“æ„ä½“å®ç°Handleræ¥å£,GRPCé€šè¿‡æœåŠ¡å’Œæ–¹æ³•æŸ¥æ‰¾åè°ƒç”¨çš„ç¬¬ä¸€ä¸ªç”¨æˆ·å‡½æ•°å°±æ˜¯transportç»„åˆç»“æ„ä¸­çš„å¯¹åº”serviceå®šä¹‰çš„æ¥å£å‡½æ•°ï¼Œ
ç„¶åè°ƒç”¨çš„æ˜¯kitçš„Serverå®ç°çš„ServerGrpcæ¥å£ï¼ŒServerå¦‚ä½•å®ç°è¿™ä¸ªè¿™æ¥å£å‘¢ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">//deferè°ƒç”¨ç»ˆç»“å‡½æ•°
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">finalizer</span>) &gt; <span style="color:#ae81ff">0</span> {
		<span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
			<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">f</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">finalizer</span> {
				<span style="color:#a6e22e">f</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">err</span>)
			}
		}()
	}
<span style="color:#75715e">//è°ƒç”¨å‰å¤„ç†å‡½æ•°
</span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">f</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">before</span> {
		<span style="color:#a6e22e">ctx</span> = <span style="color:#a6e22e">f</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">md</span>)
	}
<span style="color:#75715e">//è°ƒç”¨è¯·æ±‚æ¶ˆæ¯è§£ç å‡½æ•°
</span><span style="color:#75715e"></span><span style="color:#a6e22e">request</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">dec</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">req</span>)
<span style="color:#75715e">//è°ƒç”¨endpointå¤„ç†å‡½æ•°
</span><span style="color:#75715e"></span><span style="color:#a6e22e">response</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">e</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">request</span>)
<span style="color:#75715e">//è°ƒç”¨åå¤„ç†å‡½æ•°
</span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">f</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">after</span> {
		<span style="color:#a6e22e">ctx</span> = <span style="color:#a6e22e">f</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">mdHeader</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">mdTrailer</span>)
	}
<span style="color:#75715e">//ç¼–ç å¤„ç†ç»“æœ
</span><span style="color:#75715e"></span><span style="color:#a6e22e">grpcResp</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">enc</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">response</span>)
<span style="color:#75715e">//å¡«å…ƒæ•°æ®ä¿¡æ¯
</span><span style="color:#75715e">//è¿”å›å¤„ç†ç»“æœ
</span><span style="color:#75715e"></span><span style="color:#66d9ef">return</span> <span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">grpcResp</span>, <span style="color:#66d9ef">nil</span></code></pre></div>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬åŒ…è£…å¯¹åº”çš„æœåŠ¡æ¥å…¥ç‚¹(endpoint)åˆ°transportä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«å¯¹åº”çš„æœåŠ¡çš„transportå±‚çš„ç»“æ„ä½“ï¼Œæ³¨å†Œå¯¹åº”æœåŠ¡ã€‚
ä¸Šé¢å°±æ˜¯endpoint å’Œ transportçš„è°ƒç”¨å…³ç³»ã€‚æ¥ä¸‹æ¥çœ‹çœ‹endpointå±‚ä¸­çš„ middleware æ˜¯æ€ä¹ˆç»‘å®šçš„å‘¢ï¼Œendpointå±‚çš„middleware
çš„å®šä¹‰å¯ä»¥çœ‹å‡ºäºŒè€…çš„å…³ç³»ã€‚å¯ä»¥è¯´middlewareåŒ…è£…äº†endpoint, endpointå±‚çš„ä¸­é—´ä»¶å°±æ˜¯ä¸€ä¸ªè°ƒç”¨é“¾,ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">//å®šä¹‰ä¸­é—´ä»¶
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">InstrumentingMiddleware</span>(<span style="color:#a6e22e">duration</span> <span style="color:#a6e22e">metrics</span>.<span style="color:#a6e22e">Histogram</span>) <span style="color:#a6e22e">endpoint</span>.<span style="color:#a6e22e">Middleware</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">next</span> <span style="color:#a6e22e">endpoint</span>.<span style="color:#a6e22e">Endpoint</span>) <span style="color:#a6e22e">endpoint</span>.<span style="color:#a6e22e">Endpoint</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">request</span> <span style="color:#66d9ef">interface</span>{}) (<span style="color:#a6e22e">response</span> <span style="color:#66d9ef">interface</span>{}, <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {

			<span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">begin</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span>) {
				<span style="color:#a6e22e">duration</span>.<span style="color:#a6e22e">With</span>(<span style="color:#e6db74">&#34;success&#34;</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprint</span>(<span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span>)).<span style="color:#a6e22e">Observe</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Since</span>(<span style="color:#a6e22e">begin</span>).<span style="color:#a6e22e">Seconds</span>())
			}(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>())
			<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">next</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">request</span>)

		}
	}
}
<span style="color:#75715e">//åŒ…è£…ä¸­é—´ä»¶
</span><span style="color:#75715e"></span><span style="color:#a6e22e">sumEndpoint</span> = <span style="color:#a6e22e">InstrumentingMiddleware</span>(<span style="color:#a6e22e">duration</span>.<span style="color:#a6e22e">With</span>(<span style="color:#e6db74">&#34;method&#34;</span>, <span style="color:#e6db74">&#34;Sum&#34;</span>))(<span style="color:#a6e22e">sumEndpoint</span>)</code></pre></div>
<p>é‚£ä¹ˆå¯¹äºçš„æœåŠ¡æ¥å…¥ç‚¹æ˜¯æ€ä¹ˆç”Ÿæˆçš„å‘¢ã€‚æ¯•ç«Ÿgrpcæ³¨å†ŒæœåŠ¡æ—¶å€™æŒ‡å®šäº†ä¼ è¾“å±‚çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç”Ÿæˆendpointçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿè¦æŒ‡å®šè°ƒç”¨å¯¹åº”çš„æœåŠ¡</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">MakeConcatEndpoint</span>(<span style="color:#a6e22e">s</span> <span style="color:#a6e22e">addservice</span>.<span style="color:#a6e22e">Service</span>) <span style="color:#a6e22e">endpoint</span>.<span style="color:#a6e22e">Endpoint</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">request</span> <span style="color:#66d9ef">interface</span>{}) (<span style="color:#a6e22e">response</span> <span style="color:#66d9ef">interface</span>{}, <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
		<span style="color:#a6e22e">req</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">request</span>.(<span style="color:#a6e22e">ConcatRequest</span>)
		<span style="color:#a6e22e">v</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Concat</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">A</span>, <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">B</span>)
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">ConcatResponse</span>{<span style="color:#a6e22e">V</span>: <span style="color:#a6e22e">v</span>, <span style="color:#a6e22e">Err</span>: <span style="color:#a6e22e">err</span>}, <span style="color:#66d9ef">nil</span>
	}
}</code></pre></div>
<p>é€šè¿‡ä¸Šè¿°ä»£ç å¯ä»¥çœ‹å‡ºï¼Œç”Ÿæˆäº†endpointï¼Œä½†æ˜¯endpointé‡Œé¢å‘¢ï¼Œæ˜¯è°ƒå…·ä½“çš„æœåŠ¡ã€‚è¿™ä¸ªendpointå¯ä»¥è¯´å°±æ˜¯ä¸Šé¢endpointè°ƒç”¨é“¾
ä¸­çš„æœ«ç«¯ã€‚ä¸Šé¢çš„endpointä¸­é—´ä»¶ï¼Œè°ƒç”¨ä¸­é—´ä»¶çš„æ—¶å€™ï¼Œå¤„ç†è‡ªå·±çš„é€»è¾‘åè°ƒç”¨ä¸‹ä¸€ä¸ªendpointï¼Œæœ€åå°±è°ƒåˆ°äº†å…·ä½“çš„æœåŠ¡äº†ã€‚
æ³¨æ„è¿™é‡Œå…¥å‚æ˜¯æœåŠ¡ã€‚è™½ç„¶endpointä¹Ÿå®ç°äº†å¯¹åº”æ¥å£æ–¹æ³•ï¼Œä¸è¿‡é‚£ä¸ªæ˜¯åœ¨å®¢æˆ·ç«¯çš„æ—¶å€™ä½¿ç”¨çš„ã€‚
æ¥ä¸‹æ¥çœ‹çœ‹serviceï¼Œé¦–å…ˆå®ç°æœåŠ¡å®šä¹‰çš„åŠŸèƒ½ï¼Œaddsvcå®ä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewBasicService</span>() <span style="color:#a6e22e">Service</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">basicService</span>{}
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">basicService</span> <span style="color:#66d9ef">struct</span>{}

<span style="color:#66d9ef">const</span> (
	<span style="color:#a6e22e">intMax</span> = <span style="color:#ae81ff">1</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">31</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
	<span style="color:#a6e22e">intMin</span> = <span style="color:#f92672">-</span>(<span style="color:#a6e22e">intMax</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
	<span style="color:#a6e22e">maxLen</span> = <span style="color:#ae81ff">10</span>
)

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">s</span> <span style="color:#a6e22e">basicService</span>) <span style="color:#a6e22e">Sum</span>(<span style="color:#a6e22e">_</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span> <span style="color:#66d9ef">int</span>) (<span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">b</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">ErrTwoZeroes</span>
	}
	<span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">b</span> &gt; <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">a</span> &gt; (<span style="color:#a6e22e">intMax</span><span style="color:#f92672">-</span><span style="color:#a6e22e">b</span>)) <span style="color:#f92672">||</span> (<span style="color:#a6e22e">b</span> &lt; <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">a</span> &lt; (<span style="color:#a6e22e">intMin</span><span style="color:#f92672">-</span><span style="color:#a6e22e">b</span>)) {
		<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">ErrIntOverflow</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">b</span>, <span style="color:#66d9ef">nil</span>
}

<span style="color:#75715e">// Concat implements Service.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">s</span> <span style="color:#a6e22e">basicService</span>) <span style="color:#a6e22e">Concat</span>(<span style="color:#a6e22e">_</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span> <span style="color:#66d9ef">string</span>) (<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">a</span>)<span style="color:#f92672">+</span>len(<span style="color:#a6e22e">b</span>) &gt; <span style="color:#a6e22e">maxLen</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">ErrMaxSizeExceeded</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">b</span>, <span style="color:#66d9ef">nil</span>
}</code></pre></div>
<p>æœåŠ¡å±‚ä¹Ÿæœ‰ä¸­é—´ä»¶çš„ï¼Œé‚£æˆ‘ä»¬æ¥çœ‹çœ‹æœåŠ¡çš„ä¸­é—´ä»¶æ˜¯å•¥æ ·çš„å‘¢ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">InstrumentingMiddleware</span>(<span style="color:#a6e22e">ints</span>, <span style="color:#a6e22e">chars</span> <span style="color:#a6e22e">metrics</span>.<span style="color:#a6e22e">Counter</span>) <span style="color:#a6e22e">Middleware</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">next</span> <span style="color:#a6e22e">Service</span>) <span style="color:#a6e22e">Service</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">instrumentingMiddleware</span>{
			<span style="color:#a6e22e">ints</span>:  <span style="color:#a6e22e">ints</span>,
			<span style="color:#a6e22e">chars</span>: <span style="color:#a6e22e">chars</span>,
			<span style="color:#a6e22e">next</span>:  <span style="color:#a6e22e">next</span>,
		}
	}
}</code></pre></div>
<p>ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„ä¸­é—´ä¹Ÿæ˜¯ä¸€ä¸ªè°ƒç”¨é“¾ï¼Œä¸è¿‡è¿™é‡ŒæœåŠ¡å¯¹è±¡æ”¾åœ¨nextä¸­ã€‚æ¯ä¸ªä¸­é—´ä»¶åšå®Œè‡ªå·±çš„äº‹æƒ…åå°±è°ƒç”¨nextï¼Œè¿™æ ·
å°±è¾¾åˆ°äº†è°ƒç”¨é“¾çš„æ•ˆæœã€‚ä¸­é—´ä»¶çš„äº‹æƒ…æ˜¯å’‹åšçš„å‘¢,æœåŠ¡å±‚çš„ä¸­é—´ä»¶éœ€è¦å®ç°serviceåŠŸèƒ½ä¸­å¯¹åº”çš„æ¥å£æ–¹æ³•ï¼Œä¸­é—´ä»¶çš„äº‹æƒ…å°±æ˜¯åœ¨è¿™ä¸ªæ–¹æ³•
ä¸­å®Œæˆï¼Œå®Œæˆåå°±è°ƒç”¨nextä¸­å¯¹åº”çš„æ–¹æ³•ï¼Œserviceä¸­é—´ä»¶éœ€è¦èƒ½è¢«endpointè¯†åˆ«ä¸ºserviceï¼Œæ‰€ä»¥éœ€è¦å®ç°serviceå¯¹åº”çš„æ¥å£ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mw</span> <span style="color:#a6e22e">loggingMiddleware</span>) <span style="color:#a6e22e">Concat</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">v</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
	<span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
		<span style="color:#a6e22e">mw</span>.<span style="color:#a6e22e">logger</span>.<span style="color:#a6e22e">Log</span>(<span style="color:#e6db74">&#34;method&#34;</span>, <span style="color:#e6db74">&#34;Concat&#34;</span>, <span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#a6e22e">a</span>, <span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#a6e22e">b</span>, <span style="color:#e6db74">&#34;v&#34;</span>, <span style="color:#a6e22e">v</span>, <span style="color:#e6db74">&#34;err&#34;</span>, <span style="color:#a6e22e">err</span>)
	}()
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">mw</span>.<span style="color:#a6e22e">next</span>.<span style="color:#a6e22e">Concat</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>)
}</code></pre></div>
<p>ä¸Šé¢loggingMiddlewareå°±æ˜¯å®ç°äº†Concatæ–¹æ³•ã€‚</p>

<h2 id="æ€»ç»“">æ€»ç»“</h2>

<p>è°ƒç”¨sumæœåŠ¡ï¼š</p>

<p>grpc/transport-&gt;endpoint-&gt;service</p>

<p>1.transportå®ç°protoä¸­çš„æ¥å£ï¼Œå„ç§å¤„ç†åè°ƒç”¨endpoint</p>

<p>2.endpointè°ƒç”¨é“¾æœ€åè°ƒç”¨serviceæ–¹æ³•ã€‚</p>

<p>3.å„ä¸ªå±‚è¦ç»‘å®šæ­£ç¡®çš„ä¸‹å±‚æ–¹æ³•ã€‚</p>

<p>4.transportä¸­çš„handleræ¥å£ä¸­çš„ServerGRPC æè¿°äº†protoæ–‡ä»¶ä¸­å®šä¹‰çš„å•ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥ç”¨transportæ„é€ grpcæœåŠ¡æ—¶å€™éœ€è¦ç»„åˆtransportï¼Œ
å®ç°protoæ¥å£ä¸­çš„æ–¹æ³•ï¼Œåœ¨å®ç°çš„æ¥å£æ–¹æ³•ä¸­ï¼Œå†å»è°ƒç”¨transportä¸­å¯¹åº”åŠŸèƒ½çš„handler</p>

<hr />

<p>å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·èµèµä¸€ä¸ªå§ğŸ‘‡
<figure class="half">
    <img src="http://pb85qt5mh.bkt.clouddn.com/allpay20180702145927.jpg">
</figure></p></article>
    <footer class="post-footer">
      
      <ul class="post-tags">
        
          <li><a href="https://mfslog.github.io/tags/kit"><span class="tag">Kit</span></a></li>
        
          <li><a href="https://mfslog.github.io/tags/go"><span class="tag">Go</span></a></li>
        
      </ul>
      
      <p class="post-copyright">
        Â© This post is licensed under a Creative Commons Attribution-NonCommercial 4.0 International Licenseï¼Œplease give source if you wish to quote or reproduce.This post was published <strong>144</strong> days ago, content in the post may be inaccurate, even wrong now, please take risk yourself.
      </p>
    </footer>
    
      
    
  </section>
  <footer class="site-footer">
  <p>Â© 2017-2018 Jerry&#39;s Blog</p>
  <p>Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> with theme <a href="https://github.com/laozhu/hugo-nuo" target="_blank">Nuo</a>.</p>
  
</footer>



<script async src="//cdn.bootcss.com/video.js/6.2.8/alt/video.novtt.min.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$'], ['\\[','\\]']],
      processEscapes: true,
      processEnvironments: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      TeX: { equationNumbers: { autoNumber: "AMS" },
      extensions: ["AMSmath.js", "AMSsymbols.js"] }
    }
  });
</script>
<script type="text/x-mathjax-config">
  // Fix <code> tags after MathJax finishes running. This is a
  // hack to overcome a shortcoming of Markdown. Discussion at
  // https://github.com/mojombo/jekyll/issues/199
  MathJax.Hub.Queue(() => {
    MathJax.Hub.getAllJax().map(v => v.SourceElement().parentNode.className += ' has-jax');
  });
</script>

<script src="https://mfslog.github.io/js/bundle.d1288006cf.js"></script>




  </body>
</html>
